# 其它数据类型

LabVIEW 中有众多数据类型，限于篇幅，我们不可能对每一种类型都进行详细的讨论。在本书中，我们只侧重于介绍部分常用数据类型和它们比较富有特色的使用方法。而与数值类型相似的部分，则不再重复讨论。

有些控件并没有在这一章提及，将在后续章节使用到它们的时候，再进行详细介绍。

## 枚举

枚举类型与数值类型有些相似。枚举型的数据一定是一段连续的正整数，每一数值表示一个特定意义。

### 枚举型控件与下拉列表控件的比较

讨论到枚举型控件，就一定要提及下拉列表控件，因为这两个控件在外观上极为相似（图
2.15）。

![](images/image78.png)

图 .15 下拉列表和枚举型控件的外观

但枚举控件的数据类型是属于枚举型；而下拉列表属于数值型。表
2.2 列举了两者在属性和应用方面的主要区别。

| 控件类型 | ![](images/image79.png) | ![](images/image80.png) |
| ----- | ----------- | ----------- |
| 数据类型 | 数值型 | 枚举型 |
| 表示法 | 支持任何浮点实数类型，包括：EXT, DBL, SGL, I64, I32, I16, I8, U64, U32, U16, U8 <br /> ![](images/image81.png) | 只支持三种无符号整数类型：U32, U16, U8 <br /> ![](images/image82.png) |
| 设置数值 | 可以给每个条目设定任意的值，但是不能有数值相同的条目。 | 只能按照顺序给每个条目设定一个整数值。从 0 开始，之后每个条目加 1。 |
| 作为条件结构的条件 | 在条件结构的选择标签中，按照每个条目的值来判断条件是否满足。条件结构无法知道下拉列表中有多少条目，必须手工输入所有可能出现的条件值。 <br /> ![](images/image83.png) | 按照每个条目的标签来判断条件是否满足。条件结构知道枚举类型中每个条目，条件结构鼠标右键菜单中可以选择自动为每个枚举中的条目添加分支。 <br /> ![](images/image84.png) |
| 动态修改条目标签 | 可以通过控件的属性设置，在程序运行时，动态修改下拉列表每一项的标签。 | 只能在编辑状态下修改枚举型每一项的标签。VI 运行时不能修改。 |
| 类型严格性 | 所有下拉列表都是同一种数据类型，条目有所不同的两个下拉列表可以直接相互赋值。 <br /> ![](images/image85.png)  | 拥有不同条目的枚举属于不同数据类型，它们之间不能直接赋值。如需赋值，需要首先强制转换成一般数值类型，再转换成另一枚举类型。  <br /> ![](images/image86.png)   <br /> ![](images/image87.png)  |

表 .2 比较下拉菜单与枚举类型

通过表 2.2 的对比，我们可以得出以下结论：

在程序中，表示有限的几种物件、几个状态等含义时，应尽量使用枚举控件而不是下拉列表。因为枚举控件的数据类型更加严格，可以防止程序中的某些错误。并且，这样的数据在程序中通常会与选择结构相连，以对不同的状态、事件分别进行处理。而枚举控件按照条目标签来选择分支，可以增加程序的可读性和可维护性。

当程序需要表示的依然是一个数值，只不过需要把用户的输入限定在某几个特定值的时候，应当使用下拉列表控件。

比如，我们编写一段程序，用于模拟一台示波器，它有三种触发模式：边沿触发，脉宽触发和斜率触发。此时程序应该选用枚举类型的控件表示触发模式。这台示波器可显示的波形幅值范围也有三档，分别是：0.1V、0.25V 和 1V。它们是离散的数值，应该用下拉列表来表示这三个幅值范围。

### 单选按钮控件

除了下拉式的枚举型控件外，LabVIEW 中单选按钮控件（图
2.16）的数据类型也是枚举型的。单选按钮只是在外观上与下拉式的枚举控件不同。单选按钮由一组布尔型控件组成（可以根据需要选择改变选项的外观，以及设置一定数量的选项）。在一组控件中，每次只能有一个值为真。整个单选按钮的值，就是为真值的那个布尔控件所在的位置。

![](images/image88.png) ![](images/image89.png)![](images/image90.png)![](images/image91.png)

图 .16 单选按钮控件

单选按钮控件的优点是，所有可选的条目都直接显示在界面上，而枚举控件必须在操作中按下控件后才能查看条目内容；缺点是单选控件占用界面的尺寸比下拉式的枚举型控件大。



## 数组

### 数组数据

数组用于管理一组相同类型的数据。LabVIEW 中几乎任何其它数据类型都可以作为数组元素的数据类型，但数组本身不能作为另一个数组的元素。实际上，多维数组就有些类似于把数组作为另一个数组的元素了。在一定要把数组作为其他数组元素的时候，可以考虑先把作为元素的数组构成一个簇，再把这个簇作为另一数组的元素（图
2.18）。

![](images/image93.png)

图 .18 数组元素为簇，簇中又有数组

在 LabVIEW 内部，一个数组数据包含了两部分内容：首先是数组每个维度上的长度信息；然后是按顺序排列的数组的每个元素。

### 数组数据的运算

LabVIEW 中有些函数是专门针对数组的，比如计算数组长度、索引、排序以及计算数组的和等等。也有一些函数，它们原本用于数值类型、布尔类型等数据的计算，但是也可以直接用于对相应数据类型的数组进行运算。比如，对数值型数据进行操作的加减乘除等运算，也可以用于数值型数组；对布尔型数据进行的与或非等运算都可用于布尔型数组。

以加法为例，把一个数值和数组相加，相当于把数组中每个元素都加上这个数值。而两个数组相加，则相当于把两个数组中对应的元素相加，得到另一个数组。两输入数组元素个数不同时，结果数组长度等于两输入中长度较短的那个数组的长度。数组加法运算结果如图
2.19 所示。

![](images/image94.png)

图 .19 数组相加

对数组进行编程运算时，需要注意数组长度是否正确，尤其注意输入的数组是否可能为空。有时程序需要对输入的空数组进行特殊处理以避免出错。

### 数组数据的比较

比较函数，如 "等于？"、"大于？" 等函数也可以用于数组的比较。这些比较函数用于比较数组时，可以在右键菜单中选择 "比较元素"，或 "比较集合"。"比较元素" 的意思是对两个数组中对应的每一个元素分别进行对比，比较的结果构成了一个同长度的布尔型数组。"比较集合" 则是把数组整体作为一个数据，同另一个数组相比较，其结果为一个单个的 "真" 或 "假"（图
2.20）。

![](images/image95.png)
![](images/image96.png)

图 .20 比较数组

### 数组索引

索引是最为常用数组操作之一。使用 "索引数组" 函数，可以得到数组中某个位置上的元素的值。"索引数组" 函数的 "索引" 参数用于表明需要得到数组中的第几个元素。但是 "索引" 参数也可以为空，即在缺省情况下，相当于输入为 0，表示需要得到数组的第一个元素。

需要索引多个数组元素时，并不需要使用多个 "索引数组" 函数，而是可以把 "索引数组" 函数拉长。把鼠标移到 "索引数组" 函数下边框中间的位置，按住鼠标左键即可将其图标拉长（或缩短），左侧出现多个 "索引" 参数。每个参数都可以设置不同的值。若输入 "索引" 均为空，其缺省值依次为 0、1、2、......，即输出依次为数组的第一个，第二个，第三个...... 元素。若输入 "索引" 在某一项索引后为空，则对应空索引的输出依次为非 "空" 的那一项 + 1、+2、......。参见图
2.21：

![](images/image97.png)
![](images/image98.png)

图 .21 数组索引

索引多维数组的时候，可以索引某个元素，也可以索引某个数组子集。比如需要索引二维数组某个元素时，就要求 "索引" 参数输入两个位置信息，分别表示在两个维度上的位置；而需要索引某行或某列的所有元素时，只需输入行或列的位置信息即可（图
2.22、图 2.23）。

![](images/image99.png)

图 .22 多维数组索引

![](images/image100.png)

图 .23 多维数组索引运行结果

### 数组合并

使用 "创建数组" 函数可以把元素添加到一个数组中，或者把几个数组合并。当创建数组函数的输入为一个非数组类型数据，和一个这个类型的一维数组时，创建数组函数会把非数组数据添加到数组中去。如果两个输入数据是类型相同的一维数组，默认情况下，创建数组函数会把它们合并成一个二维数组。但是选择创建数组函数输入端右键菜单的 "连接输入"，可以把两个输入的数组首尾相连，合成一个新的一维数组（图
2.24、图 2.25）。

![](images/image101.png)

图 .24 创建数组函数的用法

![](images/image102.png)

图 .25 创建数组函数的结果

创建数组函数和数组索引函数一样，可以通过拉伸支持多个输入数据。

### 其它类型的数组控件

LabVIEW 中有些比较复杂的控件的数据类型也是数组，例如图表控件。这就使得数组数据可以有更丰富的表达方式。在某些情况下，以曲线或图形表达出来的数据比抽象的阿拉伯数字更加直观。

例如，通过某种函数计算得出一组二维数组的数据（图
2.26），希望能够观察到数据变化的规律。如果用表格的形式显示（图
2.27），虽然能够精确地显示出每一点的数值，但根本无法体现出数据变化的规律；如果以强度图的形式表示（图
2.28），虽然无法得到每一点的精确数据，但一眼就可看出数据变化的规律。

![](images/image103.png)

图 .26 利用正弦函数计算得到一个二维数组

![](images/image104.png)

图 .27 以表格表示的输出数据

![](images/image105.png)

图 .28 以强度图的形式观察数组中数据变化规律

## 簇

簇用于把多个不同类型的数据归为一组，它和 C 语言中的结构 (struct) 比较相似。LabVIEW 中最常见的簇，是错误输入 / 输出簇（图
2.29），在大多数 VI 中都能看到它的身影。它是由一个布尔类型数据、一个数值型数据和一个字符串数据组成的。

![](images/image106.png)

图 .29 错误簇

控件 "簇" 外形的大小可以自动排列。在一般情况下，可以在簇的快捷菜单中选择 "自动选择大小 -\> 垂直排列"。这样，簇中元素个数变动时，不必再手动调整簇的外观。再者，可以直观地看到簇中元素的排列顺序。因为在创建一个簇时，簇中元素摆放的顺序不一定就是簇元素排列的顺序。

"捆绑"/"松绑"（"解除捆绑"）有两种方式：一般的 "捆绑"/"松绑"，以及 "按名称捆绑 / 松绑"。它们都可以把几个简单的数据包装成一个簇，或者把簇中的元素拆分出来。在程序中应尽量使用 "按名称捆绑 / 松绑"，而不是直接 "捆绑 / 松绑"（图
2.30）。"按名称捆绑 / 松绑" 不仅可读性比较好，还可以避免诸如前后两个簇中元素顺序不一致等引发的错误。

![](images/image107.png)

图 .30 直接捆绑松绑方式虽然没有错误，但不建议使用

某些数值、布尔等类型的函数也可以用于对簇的运算，其效果与作用类似于对数组的运算。但由于簇中的元素通常拥有不同数据类型，所以需要对簇的每个元素都做某一运算的情况比较少见。

## 变体

### 变体数据类型

变体是 LabVIEW 中一种比较特殊的数据类型，其它任何数据类型都可以通过 "编程 -\> 簇、类与变体 -\> 变体 -\> 转换为变体" 函数转换成变体数据类型。需要时，可再通过 "变体至数据转换" 函数将其转换为原数据类型。变体这种数据类型类似于 VB 中的 Variant 和 C 语言中的 void 数据类型。

### 类型转换

其它类型数据在转换为变体数据类型时（图
2.40），变体数据中会记录原数据的类型信息。因此，"变体至数据转换" 只能将变体转换回原数据类型，而不能转换为其它任何类型。在变体的控件上，选中鼠标右键菜单中的 "显示类型" 和 "显示数据"，可以根据要求显示出变体内原数据的类型和数值（图
2.41）。

![](images/image125.png)

图 .40 变体数据转换

![](images/image126.png)

图 .41 在变体控件上显示内部数据的数据类型和值

在程序中，若需要得到变体数据原本的类型，可以使用一个 LabVIEW 自带的 VI（"\[LabVIEW\]\\vi.lib\\Utility\\VariantDataType\\GetTypeInfo.vi"）取出变体中数据的原始类型，然后再根据其原数据类型进行下一步处理（图
2.42）。

![](images/image127.png)

图 .42 从变体中得到元数据类型信息

在这里，我们提到了一个 LabVIEW 自带的 VI，GetTypeInfo.vi。但是这个 VI 并不能在 LabVIEW 的函数选板上找到。在本书后续的章节中，还会继续介绍到多个类似这种情况的 VI。像这种不在函数选板上的 VI，它们一般并不是直接提供给用户去使用的，而是提供给 LabVIEW 中其它 VI 或工具的子 VI。NI 公司没有为这些 VI 撰写文档，所以一般用户无法确切得知这些 VI 的用途，也不知道如何使用它们。不过，这些 VI 中的大部分是公开源代码的，用户可以查看并借鉴它们的实现方法，甚至使用它们搭建自己的应用程序。但是，如果用户把这些 VI 应用在了自己的程序中，则必须要清楚意识到使用它们的风险：第一，NI 公司不提供对这些 VI 的支持和服务。第二，NI 公司不保证这些 VI 在将来的 LabVIEW 版本中不被改动，而一旦这些 VI 被改动，很可能造成直接使用了它们的客户的应用程序出现错误。

### 变体的应用

一般来说，LabVIEW 子 VI 的参数数据类型是固定的，一个子 VI 只能针对一种特定类型的数据进行操作。但是，有些算法也可以适用于多种数据类型。针对多种不同的数据类型，为这一算法编写多个不同的子 VI，这显然不是一个高效的办法。较为行之有效的办法是选用变体数据类型作为子 VI 的参数。这样，任何类型的数据在转变为变体后，都可调用这个子 VI 了。

类似的应用还有：不同类型的数据是不能够放在同一个数组中的。但遇到需要把不同元素放在同一数组中时，可以先把所有数据都转为变体类型，然后构成一个变体类型数组。

### 利用变体实现 Dictionary 容器（字典容器）功能

编程的时候经常会遇到这种情况：需要保存一些数据，这些数据的组织类似一张表格。表格由很多类型相同的条目组成，每个条目由一个唯一的标识符（比如 ID，名称等）和其它一些数据组成。程序能够保存这张表格；对表格中的条目进行修改；并根据标识符快速找到某个条目。

在 C++ 或 C# 中实现这样的功能非常简单，只要使用编程语言提供的 Map、Dictionary 等容器就可以了。这些容器已经具有了维护和查找这张表格的功能，用户只需使用它们的几个简单接口函数。遗憾的是，至今，LabVIEW 尚未提供类似的容器。当然，可以在程序中定义一个簇的数组来保存表单中的数据，然后再编写查询数据的代码。但这种方式编程复杂，查询效率太低。

有一种简便高效的实现类似的功能方法是利用 LabVIEW 自带的用来为变体数据类型设置属性的三个函数来保存和查询数据。这三个函数位于 "编程 -\> 簇、类与变体 -\> 变体" 函数选板，分别是 "获得变体属性"、"设置变体属性" 和 "删除变体属性" 这三个函数。从它们的名字就能知道它们原本的用途了。

![](images/image128.png)\
图 2.43 变体函数选板

变体数据的属性由一个名字和一个数据组成：每个属性的名字都必须是唯一的，数据则可以是任何的数据类型。这样，它恰好适合于前文提到的容器程序需求。可以把表单中的每一个条目看作是变体数据的一个属性：条目的标识就是属性的名称；条目的其它部分是属性的数据。创建和修改表单使用 "获得变体属性" 和 "删除变体属性" 函数；查询表单的内容使用 "设置变体属性" 函数就可以了。

比如图 2.44 所示的程序，其功能是根据学生姓名来查询成绩。在这个程序中，数据是一张表格，表格的第一列为 "姓名"，第二列是 "成绩"。当用户输入一个姓名，程序就查找出相应的成绩，返还给用户。

![](images/image129.png)\
图 2.44 使用变体属性实现 Dictionary 容器的程序框图

![](images/image130.png)\
图 2.45 使用变体属性实现字典容器的程序运行结果

变体的属性在 LabVIEW 中是以哈希表格式存储的。它的查询效率极高，所以特别适合用于需要查询大量数据的程序。

但它毕竟不是一个真正的容器，还有一些局限性，比如它的标识只能使用字符串。在本书第 13.3.5 节，将要更为详细地介绍数据容器。请读者参阅相关章节。

## 练习


