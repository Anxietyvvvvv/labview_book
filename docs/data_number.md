# 数值数据

## 数值控件及其显示格式

通常，LabVIEW 控件选板上排在第一位的就是放置数值控件的选板：

![](images/image62.png "数值控件选板")

这一栏中的控件虽然在前面板上的外观各不相同，但是它们所表示的数据类型是相同的，都属于数值类型。选板右上方两个控件的数据类型是“时间”，也是数值数据的一种显示方式。还有其它一些控件，尽管位于别的选板，但它们的数据类型也是数值型的，比如下拉列表控件、列表框控件等。

这个控件选板上头两个控件是最常用的数值类型控件，尽管它们的外观是最简单。他俩的区别只在于第一个是控制控件，第二个是显示控件。控制控件比显示控件底色更浅，同时在左侧多了两个增减按钮。在鼠标键盘操作的系统中，这两个按钮比较鸡肋，但是在触摸屏操作的系统上还是有实用性的。除了这两个基本控件，编程人员还可以根据数据的应用环境和表达的具体意义来选定一种控件。例如，在工厂生产流程中，表示某个油罐内的储存油量时，可以选择液罐控件；模拟汽车仪表盘的时候应该选仪表控件；等等。

LabVIEW 数值控件还有丰富的各种设置和显示方式，有一些在控件的鼠标右键菜单中就能发现，比如设置空间数据的进制、单位等：

![](images_2/z139.png "数值控件鼠标右键菜单")

而更多的设置是在控件的属性对话框中。在控件的右键菜单上点击“属性”，就会打开属性对话框：

![](images/image63.png "配置数值控件的显示格式")

我们可以在属性对话框中设置控件的状态、尺寸、数据范围等等。这里大多数设置是比较直观的，看到名字就能够理解。比如，设置数值范围可以对数据的范围加以限制，避免程序运行时出现数值越界错误。设置显示格式可以方便用户观察数据。

在属性对话框的显示格式页上，我们可以选择用何种方式显示一个数据，比如是以小数方式，还是科学记数法或是工程记数法来显示，对于整数还可以选择进制，比如二进制、十六进制等。如果我们正在设置的数值表示的是一个时间，使用单一的数值来显示时间显然不符合我们识别时间的习惯。我们需要让它按照年月日的格式把时间值显示出来。设置时间显示方式，相对复杂一些，尤其当我们需要使用自定义的格式时。这时，可以在显示格式页面中，先选择需要设置的类型是“绝对时间”（或“相对时间”），然后再在下方选择“高级编辑模式”，就可以为控件设置显示方式了（如上图）。例如，在 "格式字符串" 一栏中输入 "%<% Y-% m-% d % H:% M:% S>T"，可以让控件按照 "年 - 月 - 日 时：分：秒" 的格式把一个实数数值显示出来。

实数“0.0”用绝对时间格式表示如下：

![](images/image64.png "按时间格式显示的数值控件")

当一个实数用来表示绝对时间时，其含义是指北京时间 1904-01-01 08:00:00 （相当于格林威治时间 1904-01-01 12:00am）这一时刻之后的多少秒。

## 常量

鼠标右键点击某一个数值型数据常量，可以看到其快捷菜单中 "匹配至输入数据" 一项是默认选中的。也就是说，常量将会根据输入值自动选择表示法。例如，在常量中输入一个正数，假设为 "34"，常量的类型会自动变为 I32 整型（蓝色 ![](images/image65.png)）；假如输入为 "34.3"，常量的类型会自动变为 DBL 实数型（桔黄色 ![](images/image66.png)）。如果要输入实数型 34，则应该输入 "34.0"。

数值型控件并无这一选项。也就是说，对数值型控件而言，必须视需要人为选择控件的表示法。

## 表示法

一个数值型数据还可以有多种不同的表示法，用来表示不同范围和精度的数据。我们可以认为数值类型属于一种数据类型，而 I32，U8 等只是不同的表示法；也可以把数值类型的不同表示法视作不同数据类型。在文本编程语言中，一般都是把 I32，U8 等当作不同的数据类型处理的。

在 VI 的前面板上放置一个数值型控件，或在程序框图上放置一个数值常量，在它们的右键菜单中可以查看或更改其表示法（Representation）：

![](images/image67.png "数值类型的不同表示法")


在 LabVIEW 帮助的索引中搜索“数值”，打开数值分类下的数据，可以查看到每种表示法的详细解释。从表示法的图标中可以很清楚地看出，每种表示法的区别在于数据长度不同。计算机使用的是二进制，每一位可以表示 0 或 1 两个值，8 位为 1 字节。每种表示法的长度如下表所示。

| | | | |
|-----|------------------------|-----|---------------------|
| EXT | 扩展精度实数，16 字节长   | DBL | 双精度实数，8 字节长   |
| SGL | 单精度实数，4 字节长      | FXP | 定点数，最大 8 字节长   |
| I64 | 带符号 64 位整数           | I32 | 带符号 32 位整数        |
| I16 | 带符号 16 位整数           | I8  | 带符号 8 位整数         |
| U64 | 无符号 64 位整数           | U32 | 无符号 32 位整数        |
| U16 | 无符号 16 位整数           | U8  | 无符号 8 位整数         |
| CXT | 扩展精度复数，2×16 字节长 | CDB | 双精度复数，2×8 字节长 |
| CSG | 单精度复数，2×4 字节长    |     |                       |



一般来说，长度越长，可以表示的数值范围就越大、精度也越高，但计算速度越慢，占用存储空间也越大。

选择表示法首先要考虑能够满足程序需求。比如说 I16 表示法能够支持的数值范围是 - 32768 到 32767 之间的整数，这个范围甚至不够计算 300×300 这样的简单算术运算。我们不妨现在就编写一个程序：新建一个 VI，在 VI 上放置两个值为 300 的 I16 常量，然后相乘，将乘积用一个 I16 的数值控件来显示，看看他们的积是多少。这种错误如果隐藏在一个大工程内，查找起来也是颇为费劲的。

![](images/image507.png "数值溢出错误")


I64 可以表示的范围就要大很多，可以达到 $10^{18}$ 数量级。但这样的数量级如果用于计算阶乘，最多也只能算到 20 的阶乘（即 20！）。需要更广泛的数值范围，或者用到小数时，就要使用实数表示法。某些科学计算中还需要用到复数。

其次，要考虑程序的运行效率和存储效率。计算机对于实数的运算速度要大大慢于整数运算。所以，程序中的数据，若能够以整数表示的，如表示人数、物件个数等只可能出现整数的物理量，数值又不会太大时，尽量使用整数，而不要用实数。

复数是由两个分别表示实数部和虚数部的实数组成的，运算速度更慢。

对于单个数据而言，使用 U16 与使用 U32 表示法相比，不过相差两字节。这个长度上的差别可以忽略不计，对程序占用的存储空间根本不会有什么影响。为安全起见，不妨尽量使用长度较大的表示法。但如果数据量较大时，选择不同表示法会导致程序内存占用的巨大差异，需要加以慎重选择。比如用于一个拥有大量元素的数组，若数组有 1,000 个元素时，元素采用 U16 与 U32 表示法相比，则有 2K 字节存储空间的差别；若数组有 1,000,000 个元素时，差别达到 2M 字节，已经相当可观。

## 数值运算的常用函数

与数值数据相关的基本运算函数和节点大多位于“编程 -\> 数值”函数选板下：

![](images/image68.png "数值运算相关节点")

这些函数节点的图标非常直观地表示出了它们的功能：加、减、四舍五入、求倒数等。在“数学”函数选板中，还有一些更复杂的有关数学运算的函数和 VI。每一个函数的功能可以在 LabVIEW 帮助文档上找到，本书就不重复了。

数学运算的算法纷繁复杂，难免有时需要一个函数，却不知道它藏在哪个函数选板下。这时，可以利用函数或控件选板的搜索功能，点击函数或控件选板上方的“搜索”按钮（图标为放大镜的按钮），就可以进入选板搜索功能：

![images_2/z132.png](images_2/z132.png "搜索选板")

在搜索界面上输入关键词，然后选中一个搜索结果，拖放到 VI 的程序框图或前面板上即可。如果双击一个搜索结果，会跳转到这个结果所在的选板位置，这样我们就能够知道这个节点放置在哪个选板上，以后可以直接到这个选板下选择该节点。



## 表达式节点

对于简单的加减乘除运算，使用基本的函数节点就够用了。如果是较为复杂的数值运算，就需要大量函数节点。节点之间的连线可能会有转角甚至相互交叉，显得比较杂乱，不利于程序阅读和维护。此种情况下，我们可以选用其它一些更好的编程方法。

对于只有一个输入和一个输出的运算，我们可以使用表达式节点。

比如，我们要计算华氏温度到摄氏温度的转换，可以通过基本运算函数完成。尽管运算并不复杂，但读者恐怕还是无法一下子就意识到这个运算与计算公式是完全一致的，还需要一步一步加以判断。这是图形化语言在表达纯数学计算时的弱点。而文字表达方式，因为它与教科书、文字资料中常见的公式书写一致，所以更为直观易懂。在 LabVIEW 中，表达式节点是使用文字来描述运算的。下图的下半部分显示的就是一个使用表达式节点的程序，用户可以直观地读出该节点所使用的公式：

![](images/image69.png "表达式节点的应用")

与使用基本运算节点相比较，表达式节点的另一个优点是节省了框图上的空间。

在表达式节点中只允许有一个字符串代表输入参数，即只能计算单变量函数。例如，上图中用 f 表示输入参数。

LabVIEW 在线帮助里列出了表达式节点所支持的运算符、函数和表达式规则。LabVIEW 的表达式节点，以及后文将要提到的公式节点，在书写数学表达式时，都借鉴了 C 语言的运算符和函数名，如果有 C 语言基础，基本上不需要查找帮助也可以直接写出来，比如加减乘除，或者 ** 表示指数运算，sqrt() 表示开方等等。

## 公式 Express VI

如果运算有多个输入，可以使用公式 [Express VI](measurement_express_vi)：

![](images/image71.png "公式 Express VI 在程序框图上的外观")

我们在后续章节中还会详细讨论 [Express VI](measurement_express_vi) 的特点和使用方法，这里仅简单介绍一下公式 Express VI。该 VI 在函数选板 "数学 -\> 脚本与公式" 下。把它拖到程序框图上，它会立刻弹出一个配置面板，它看起来就像是一台高档计算器，用户基本不需要学习就可以使用了：

![](images/image70.png "配置公式 Express VI")

公式 Express VI 允许使用最多 8 个输入数据，但只能有一个输出数据。公式 Express VI 的缺点是：它的表达式是隐藏起来的，在程序框图上看不到具体的公式。用户需要查看计算公式时，先要双击这个 VI，调出配置面板才能看到。

## 公式节点

对于多输入多输出或更加复杂的计算，可以使用公式节点：

![](images/image72.png "公式节点")

用户可以把它看作是更为复杂的支持多输入输出的表达式节点。公式节点中的表达式语法与 C 语言类似，相当于实现了一个只包含基础的数学运算的 C 语言的子集。熟悉 C 语言的用户，使用公式节点不会感到陌生。

在实现算法时，人们往往更习惯于文本表达方式。我们在书本中学习到的公式，对计算过程的描述，都是用文本方式来表达的。并且，在具有较多[选择结构](structure_condition)的程序中，文本表达方式可以有顺序地显示所有分支中的内容；而 LabVIEW 在遇到选择结构时，每次只能显示一个分支的内容，其它的分支要点击鼠标后才能逐页读到，可读性差。因此，在较为复杂的数学运算程序中，使用公式节点可以让程序的可读性和可维护性得到提高。



下图是一个棋类游戏程序中的一个子 VI，用于计算可以走子的位置。它实际上就是针对一个二维整数数组的一些简单数值操作。程序嵌套了多个循环与选择结构，使得它相当难以读懂。读者不需要理解它的程序，这是只是用它来展示一下 LabVIEW 代码可能会达到的复杂程度。

![](images/image73.png "计算可以走子的位置")

下图是一个完成相同功能但使用了公式节点的子 VI 的程序框图。对于一个 C 语言水平与 LabVIEW 水平差不多的程序员来说，下图这个程序读起来会更加顺畅，公式节点中的代码也更容易理解。

![](images/image74.png "用公式节点计算可以走子的位置")

公式节点的缺点是：对于毫无 C 语言编程经验的用户，还要花费一些时间先学习公式节点的语法，给他们增加了一点额外的使用成本。

公式节点中的代码无法设置断点和进行调试。为了保证公式节点中代码的正确性，可以先在一个 C 语言编译器中对其进行编译调试，在保证其正确性后再在放入 LabVIEW 公式节点中使用。


## 数值的单位

LabVIEW 被广泛的应用与测控领域，LabVIEW 中的数据通常不是抽象的数值，而是代表实际意义的物理量。因此，LabVIEW 的数值型控件和常量是可以带单位的。在数值型控件的快捷菜单上选择 "显示项 -\> 单位标签"，就可输入数值的单位了。单位是用英文字母缩写来表示的，如果你对某个单位的正确拼写没有把握，可以先任意输入一个字符，然后用鼠标右键点击单位标签，选择 "创建单位字符串"。这时，LabVIEW 会弹出一个对话框，显示出 LabVIEW 支持的所有单位。

数据从一个单位转换为其它单位时，数值是会自动换算。例如要计算 2 年有多少天，可以用下图中的程序：

![](images/image75.png "年与天的换算")

给某种数据类型的控件赋予另一种数据类型的数据，如把一个 I32 型的数据赋值给字符串型的控件，肯定是一种错误行为。LabVIEW 与大多数编程语言一样，也具备在编译时报告此类错误的功能。除此以外，LabVIEW 还具备对数值型数据进行单位一致性检查的功能。这种检查更严格：不仅实数与字符串之间不可以相互赋值；同样是实数型的两个数据，如一个表示时间，另一个表示长度，它们之间也不能相互赋值。

故此，我们在编写 LabVIEW 程序的时候，应当尽量使用带单位的数值控件。当试图把表示时间的数据和表示长度的数据相加时，LabVIEW 会禁止这种连线。这有助于防止编程时出现的不一致性错误：

![](images/image76.png "不同类型的数据不能进行计算")

一个带单位的物理量，和一个不带单位的数值之间，有些运算是被允许的，有些则不行。比如数字常量 π 是不带单位的，当计算直径为两米的圆的周长时，可以计算 2m * π，这是允许的，但是两米与 π 相加则不符合物理规则。

![](images_2/z136.png "有单位数据与无单位数据的运算")

但是，这种严格的单位一致性的检查也可能会带来麻烦。例如，我们编写了一个子 VI，用于计算两个时间数据之和。下次，当我们需要一个计算长度数据之和的子 VI 时，却不能够直接使用这个已有的、计算时间数据的子 VI，因为它们的单位是不同的。为了解决这个问题，LabVIEW 提供了单位通配符。

在编写能够适用于不同单位的子 VI 时，可以使用单位通配符。单位通配符用 \$n 表示，其中 n 是 1 到 9 之间的任意一个数字。以我们刚才提到的加法为例：可以在子 VI 中使用通配符 \$1；如果还需要一个执行其他运算的子 VI，其单位可以用 \$2 表示；依此类推。

![](images/image77.png "使用单位通配符")


非常遗憾的是，LabVIEW 很多自带的 VI 却没有使用单位匹配符，直接把有单位的数据传递给它们，LabVIEW 就会报错。这时候只能稍微麻烦一些，把有单位的数据转换成无单位数据，计算完之后再转回有单位数据。


使用“单位转换”(Convert Unit)节点（在“编程 -\> 数值 -\> 转换函数”选板下）可以把一个纯数字量转换为带有单位的数字量，或者反向转换。比如，我们想要生成一个在一米到两米之间的随机长度，可以使用 LabVIEW 自带的“Random Number (Range).vi”，但是这个 VI 没有使用单位通配符，我们只能作单位转换后再使用它：

![](images_2/z137.png "单位转换")

使用同一选板下的“基本单位转换”（Cast Unit Bases）节点，可以更灵活地把某一数值从一个单位直接转换成另一单位。需要注意的是，单位转换节点的外观和表达式节点的外观一模一样，甚至在早期版本中，它们的鼠标右键快捷菜单也一模一样，但它们的功能完全不同。千万不要用弄混了，下图程序中两个节点虽然看上去一样，但产生而结果却不同：

![](images_2/z138.png "单位转换与表达式节点")




## 练习

* 笔者家的客厅是一个长为 22.5 英尺，宽为 12.5 英尺的长方形。编写一个 VI 计算一下笔者家客厅的面积是多少平方米？
